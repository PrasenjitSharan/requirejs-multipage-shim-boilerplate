define(["jquery","d3"],function(e,t){return function(){function o(o){var u=Math.min(n-s,r)/2-10,a=u*.5,f=u,l=u+15,c=t.svg.arc().innerRadius(a).outerRadius(f);angleOffset=Math.PI/2,donut=t.layout.pie().startAngle(angleOffset).endAngle(Math.PI*2+angleOffset).value(function(e,t){return e[1]});var h=o.append("svg").attr("class","visualization-donut").attr("viewBox",[0,0,n,r]).attr("preserveAspectRatio","xMidYMid").data(o.data()).append("svg:g").attr("transform","translate(0,"+(r/2-u)+")"),p=h.append("defs").append("linearGradient").attr("id","wash").attr("x1",0).attr("x2",0).attr("y1",-u).attr("y2",u).attr("gradientUnits","userSpaceOnUse");p.append("stop").attr("offset",0).attr("stop-color","white"),p.append("stop").attr("offset",1).attr("stop-color","black");var d=h.selectAll("g.arc").data(donut).enter().append("g").attr("class","arc").attr("transform","translate("+f+","+f+")");d.append("path").attr("class","arc").attr("fill",function(e,t){return i(t)}).attr("d",c),d.append("svg:path").attr("class","arc").attr("fill","url(#wash)").attr("fill-opacity",.1).attr("d",c);var v=t.scale.category10(),m=o.attr("style","position: relative").insert("div",":first-child").attr("style","position: absolute; top: 0; left: "+(u*2+16)+"px; right: 0").attr("class","legend").selectAll("p").data(o.data()[0]).enter().append("p").html(function(e,t){return e[0]+"<br><strong>"+e[1]+"%</strong>"});d.each(function(t,n){var r=c.centroid(t),i=e(m[0][n]).offset(),s=e(h.node()).offset(),o=Math.floor(i.left-s.left-10),u=Math.floor(i.top-s.top+4),a=u,l=Math.asin(Math.max(0,a/f)-1),p=3+f+Math.floor(f*Math.cos(l));if(a<5){p=f*1.6;var d=f*.05,v=Math.asin(d/f-1),g=f+6+Math.floor(f*Math.cos(v));h.insert("svg:line").attr("class","whisker").attr("x1",p).attr("y1",u+.5).attr("x2",g).attr("y2",d+.5)}if(a>f*2-5){p=f*1.6;var d=f*1.95,v=Math.asin(d/f-1),g=f+6+Math.floor(f*Math.cos(v));h.insert("svg:line").attr("class","whisker").attr("x1",p).attr("y1",u+.5).attr("x2",g).attr("y2",d+.5)}h.insert("svg:line").attr("class","whisker").attr("x1",p).attr("y1",a+.5).attr("x2",o).attr("y2",u+.5)})}var n=720,r=80,i=t.scale.ordinal().range(["#08A5E1","#6BC9ED","#056083"]),s=80;return o.width=function(e){return arguments.length?(n=e,o):n},o.height=function(e){return arguments.length?(r=e,o):r},o}})